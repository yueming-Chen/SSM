{"version":3,"sources":["../../tmp/notify/notify.service.ts"],"names":[],"mappings":"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","file":"notify.service.js","sourceRoot":"","sourcesContent":["import { Injectable, EventEmitter } from \"@angular/core\";\nimport { bind } from \"@ay/util\";\n\n\nexport class NotifyService {\n  public defaultTimeout: number = 0;\n  public maxStack: number = 6;\n  public list: Notify[] = [];\n  public createNotifyEvent = new EventEmitter<Notify>();\n  public setTimeoutEvent = new EventEmitter<Notify>();\n  public setDefaultTimeout(timeout: number) {\n    this.defaultTimeout = timeout;\n  }\n\n  public setMaxStack(count: number) {\n    this.maxStack = count;\n  }\n\n  public removeFromArray(array, item) {\n    let index = array.indexOf(item);\n    if (index === -1) return;\n    array.splice(index, 1);\n  }\n\n  public generatorDestroyer(toasty: Notify): Function {\n    let destroy = () => {\n      toasty.status = \"hidden\";\n      setTimeout(() => {\n        this.removeFromArray(this.list, toasty);\n      }, 500);\n    }\n    toasty.destroy = destroy;\n    return toasty.destroy;\n  }\n\n  public add(toasty: Notify): Notify {\n    if (toasty.timeout === null) toasty.timeout = this.defaultTimeout;\n    this.list.push(toasty);\n    //提示數量大於最大限制時，刪除舊提示\n    if (this.list.length > this.maxStack) {\n      this.list.shift().destroy();\n    }\n    this.createNotifyEvent.next(toasty);\n    //產生 Notify解構元、計時器、計時器解構元;\n    this.generatorDestroyer(toasty);\n    return toasty;\n  }\n\n  public info(title: string, message: string = \"\", timeout = this.defaultTimeout): Notify {\n    return this.add(new Notify(title, message, timeout, \"fa-bell\"));\n  }\n\n  public success(title: string, message: string = \"\", timeout = this.defaultTimeout): Notify {\n    return this.add(new Notify(title, message, timeout, \"fa-check\", \"#FFFFFF\", \"#32B867\"));\n  }\n\n  public error(title: string, message: string = \"\", timeout = this.defaultTimeout): Notify {\n    return this.add(new Notify(title, message, timeout, \"fa-exclamation-triangle\", \"#FFFFFF\", \"#FF414A\"));\n  }\n\n  public warning(title: string, message: string = \"\", timeout = this.defaultTimeout): Notify {\n    return this.add(new Notify(title, message, timeout, \"fa-exclamation\", \"#FFFFFF\", \"#FFB141\"));\n  }\n\n  public loading(title: string, message: string = \"\", timeout = this.defaultTimeout): Notify {\n    return this.add(new Notify(title, message, timeout, ['fa-refresh', 'fa-spin'], \"#FFFFFF\", \"#34495e\"));\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n];\n}\n\nexport class Notify {\n  public status = \"normal\";\n  public showClose: boolean = true;\n  public constructor(\n    public title: string,\n    public message: string = \"\",\n    closeTimeout: number = 0,\n    /** 可支援格式參照 ngClass: https://angular.io/docs/ts/latest/api/common/index/NgClass-directive.html */\n    public icon: any = \"\",\n    public color: string = \"#333333\",\n    public backgroundColor: string = \"#FFFFFF\"\n  ) {\n    this.timeout = closeTimeout;\n  }\n  public update(title?: string, message?: string, timeout?: number, icon?: any, color?: string, backgroundColor?: string) {\n    if (typeof title == \"string\") this.title = title;\n    if (typeof message == \"string\") this.message = message;\n    if (typeof timeout == \"number\") this.timeout = timeout;\n    if (icon != null) this.icon = icon;\n    if (typeof color == \"string\") this.color = color;\n    if (typeof backgroundColor == \"string\") this.backgroundColor = backgroundColor;\n  }\n\n  private _timeout: number = 0;\n  public timerCount: number = 0;\n  public onDestroyEvent = new EventEmitter<Notify>();\n  public timeCountChange = new EventEmitter<Notify>();\n  public set timeout(num: number) {\n    if (this._timeout != num) {\n      this._timeout = num;\n      this._generatorTimer();\n    }\n    //沒有設定關閉時間則顯示關閉按鈕\n    this.showClose = (this.timeout <= 0);\n  }\n  public get timeout(): number {\n    return this._timeout;\n  }\n\n  //Notify 的解構元\n  private _destroy: Function;\n  public set destroy(_destroyFunction: Function) {\n    this._destroy = (() => {\n      _destroyFunction();\n      this._destroyTimer();\n      this.onDestroyEvent.next(this);\n      this._destroy = null;\n    }).bind(this);\n  }\n  public get destroy(): Function {\n    return this._destroy ? this._destroy : () => { };\n  }\n\n  //計時器 的解構元，備註：會被 Notify 的解構元呼叫到\n  private _destroyTimer: Function = () => { }\n\n  private _generatorTimer() {\n    //解構舊的計時器\n    this._destroyTimer();\n    this.timerCount = this.timeout;\n    if (this.timeout > 0) {\n      //產生計時器\n      let counter = null\n      let timeAction = () => {\n        this.timerCount -= 1;\n        this.timeCountChange.next(this);\n        if (this.timerCount <= 0) this.destroy();\n      }\n      counter = setInterval(timeAction, 1000)\n      this._destroyTimer = () => { clearTimeout(counter); };\n    }\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}