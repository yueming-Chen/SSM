{"version":3,"sources":["../../tmp/tooltip/tooltip.directive.ts"],"names":[],"mappings":"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","file":"tooltip.directive.js","sourceRoot":"","sourcesContent":["import {\n  Directive, Input, ElementRef, ComponentRef, TemplateRef, ViewContainerRef,\n  Renderer, ComponentFactoryResolver, Injector, EmbeddedViewRef, ComponentFactory,\n  Output, EventEmitter, NgZone, HostListener\n} from '@angular/core';\nimport * as Tether from 'tether';\nimport 'rxjs/add/operator/take';\nimport { TooltipComponent } from './tooltip.component';\nimport { placement, Direction } from './placements';\nimport { toBoolean } from \"../util/util\";\nimport { bind } from \"@ay/util/dist\";\n\n\nexport class TooltipDirective {\n  \n  public behavior: \"hover\" | \"click\" | \"focus\" = \"hover\";\n\n  \n  public tooltip: string | TemplateRef<any>;\n\n  \n  public set direction(_direction: Direction) {\n    this._direction = _direction || 'top';\n    this.setTether();\n  }\n\n  \n  public set delay(delay: any | any[]) {\n    delay = Array.isArray(delay) ? delay : [delay, delay];\n    [this.openDelay, this.closeDelay] = delay.map(Number);\n  }\n\n  \n  public set open(open: boolean) {\n    this.toggle(open, open ? this.openDelay : this.closeDelay);\n  }\n\n  \n  public toggled = new EventEmitter<boolean>();\n\n  private popover: TooltipComponent;\n  private popoverFactory: ComponentFactory<TooltipComponent>;\n  private componentRef: ComponentRef<TooltipComponent>;\n  private viewRef: EmbeddedViewRef<any>;\n  private _direction: Direction = 'top';\n  private tether: Tether;\n  private openDelay = 0;\n  private closeDelay = 0;\n  private toggleTimeout: any = null;\n  private interactiveSubscription: any = null;\n\n  \n  onMouseClick($event: MouseEvent) {\n    console.log(\"onMouseClick\");\n    if (this.behavior === 'click') {\n      this.open = true;\n      $event.preventDefault();\n      setTimeout(() => {\n        window.addEventListener('click', this.onWindowsClick);\n      });\n    }\n  }\n\n  @bind\n  onWindowsClick() {\n    console.log(\"onWindowsClick\");\n    if (this.behavior === 'click') {\n      this.open = false;\n      window.removeEventListener('click', this.onWindowsClick);\n    }\n  }\n\n  \n  onMouseOver() {\n    if (this.behavior === 'hover') {\n      this.open = true;\n    }\n  }\n\n  \n  onMouseOut() {\n    if (this.behavior === 'hover') {\n      this.open = false;\n    }\n  }\n\n  \n  onFocus() {\n    if (this.behavior === 'focus') {\n      this.open = true;\n    }\n  }\n\n  \n  onBlur() {\n    if (this.behavior === 'focus') {\n      this.open = false;\n    }\n  }\n\n\n  constructor(\n    private element: ElementRef,\n    private viewContainer: ViewContainerRef,\n    private injector: Injector,\n    private ngZone: NgZone,\n    private renderer: Renderer,\n    componentFactoryResolver: ComponentFactoryResolver\n  ) {\n    this.popoverFactory = componentFactoryResolver.resolveComponentFactory(TooltipComponent);\n  }\n\n  public position(async = true) {\n    this.ngZone.runOutsideAngular(() => {\n      if (async) {\n        setTimeout(() => this.tether.position());\n      } else {\n        this.tether.position();\n      }\n    });\n  }\n\n  public ngOnDestroy() {\n    this.destroy();\n  }\n\n  private toggle(open: boolean, delay: number) {\n    if (this.toggleTimeout) {\n      clearTimeout(this.toggleTimeout);\n      this.toggleTimeout = null;\n    }\n\n    const toggleFn = (open ? this.create : this.destroy).bind(this);\n\n    if (delay > 0) {\n      this.toggleTimeout = setTimeout(() => {\n        this.toggleTimeout = null;\n        toggleFn();\n      }, delay);\n    } else {\n      toggleFn();\n    }\n  }\n\n  private setTether(create = false) {\n    if (!this.tether && !create) return;\n\n    const { attachment, targetAttachment, offset } = placement(this._direction);\n    const options = {\n      element: this.popover.element.nativeElement,\n      target: this.element.nativeElement,\n      attachment,\n      targetAttachment,\n      offset,\n    };\n\n    if (create) {\n      this.tether = new Tether(options);\n    } else {\n      this.tether.setOptions(options);\n    }\n\n    this.setPopover();\n  }\n\n  private setPopover() {\n    if (!this.popover) return;\n\n    const { opposite } = placement(this._direction);\n  }\n\n  private create() {\n    if (this.componentRef) {\n      return;\n    }\n\n    const { nodes, viewRef } = this.getProjectableNodes();\n    this.viewRef = viewRef;\n\n    this.componentRef = this.viewContainer.createComponent(this.popoverFactory, 0, this.injector, [nodes]);\n    this.popover = this.componentRef.instance;\n    this.popover.afterViewInit.take(1).subscribe(() => this.position(false));\n\n    this.setTether(true);\n\n    this.popover.changeDetector.markForCheck();\n\n    this.toggled.emit(true);\n  }\n\n  private getProjectableNodes(): { nodes: any[], viewRef?: EmbeddedViewRef<any> } {\n    if (this.tooltip instanceof TemplateRef) {\n      const viewRef: EmbeddedViewRef<any> = this.viewContainer.createEmbeddedView(<TemplateRef<any>>this.tooltip);\n      return { nodes: viewRef.rootNodes, viewRef };\n    } else {\n      return { nodes: [this.renderer.createText(null, <string>this.tooltip)] };\n    }\n  }\n\n  private destroy() {\n    if (!this.componentRef) return;\n\n    this.tether.destroy();\n    this.tether = null;\n\n    if (this.viewRef) {\n      this.viewContainer.remove(this.viewContainer.indexOf(this.viewRef));\n      this.viewRef = null;\n    }\n\n    this.viewContainer.remove(this.viewContainer.indexOf(this.componentRef.hostView));\n    this.componentRef.destroy();\n    this.componentRef = null;\n    this.popover = null;\n\n    if (this.interactiveSubscription) {\n      this.interactiveSubscription.unsubscribe();\n    }\n\n    this.toggled.emit(false);\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[tooltip]',\n  host: {\n    \"tabindex\": \"1\"\n  }\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: ViewContainerRef, },\n{type: Injector, },\n{type: NgZone, },\n{type: Renderer, },\n{type: ComponentFactoryResolver, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'behavior': [{ type: Input },],\n'tooltip': [{ type: Input },],\n'direction': [{ type: Input },],\n'delay': [{ type: Input },],\n'open': [{ type: Input },],\n'toggled': [{ type: Output },],\n'onMouseClick': [{ type: HostListener, args: ['click', ['$event'], ] },],\n'onMouseOver': [{ type: HostListener, args: ['mouseenter', ] },],\n'onMouseOut': [{ type: HostListener, args: ['mouseleave', ] },],\n'onFocus': [{ type: HostListener, args: ['focus', ] },],\n'onBlur': [{ type: HostListener, args: ['blur', ] },],\n};\n};\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}