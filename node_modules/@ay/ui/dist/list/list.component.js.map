{"version":3,"sources":["../../tmp/list/list.component.ts"],"names":[],"mappings":"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","file":"list.component.js","sourceRoot":"","sourcesContent":["import { Component, AfterContentInit, OnDestroy, AfterViewInit, ApplicationRef, Output, EventEmitter, Input, ElementRef, TemplateRef, ViewChild, ContentChild, HostListener, ViewEncapsulation } from '@angular/core';\nimport { toObservable, defaults, bind, toObserver } from \"@ay/util\";\n\nexport enum Direction {\n  Down = 0,\n  Up = 1\n};\n\n\nexport class ListComponent implements AfterContentInit, OnDestroy, AfterViewInit {\n  public that = this;\n  public dragedIndex: number;\n  public hoveredIndex: number;\n  public dragedItem: any;\n  public direction: Direction;\n  public isLoading: boolean;\n  public queriedItems: any[] = [];\n  private _updateItemsChange$: any;\n  public isDraging: boolean;\n  private _title: string = \"\";\n  //- 屬性\n\n  // title\n  \n  public get title(): string {\n    return this._title;\n  }\n\n  public set title(title: string) {\n    if (this._title === title) return;\n    this._title = title;\n  }\n\n\n  /** icon */\n  \n  public icon: string = \"fa-bars\";\n\n  /** items */\n  private _items: toObservable<any> = [];\n\n  \n  public get items(): toObservable<any> {\n    return this._items;\n  }\n\n  public set items(items: toObservable<any>) {\n    if (this._items === items) return;\n    this._items = items;\n  }\n\n  /** empty */\n  private _empty: string;\n\n  \n  public get empty(): string {\n    return this._empty;\n  }\n\n  public set empty(empty: string) {\n    if (this._empty === empty) return;\n    this._empty = empty;\n  }\n\n\n  //- 樣板\n  /** Item */\n  \n  public defaultItemTemplate: ElementRef = null;\n\n  \n  public itemTemplate: TemplateRef<any> = null;\n\n  /** Title */\n  \n  public defaultTitleTemplate: ElementRef = null;\n\n  \n  public titleTemplate: TemplateRef<any> = null;\n\n  /** Empty */\n  \n  public defaultEmptyTemplate: ElementRef = null;\n\n  \n  public emptyTemplate: TemplateRef<any> = null;\n\n  public constructor(public _app: ApplicationRef) {\n  }\n\n  public ngAfterViewInit(): void {\n\n  }\n\n  public ngOnDestroy(): void {\n    if (this._updateItemsChange$) this._updateItemsChange$.unsubscribe();\n  }\n\n  public ngAfterContentInit(): void {\n    this.itemTemplate = defaults(this.itemTemplate, this.defaultItemTemplate);\n    this.titleTemplate = defaults(this.titleTemplate, this.defaultTitleTemplate);\n    this.emptyTemplate = defaults(this.emptyTemplate, this.defaultEmptyTemplate);\n    this.queryItems();\n  }\n\n  @bind\n  public queryItems() {\n    if (this._updateItemsChange$) { this._updateItemsChange$.unsubscribe(); }\n    if (!this.queriedItems) { return null; }\n    this.queriedItems = [];\n    this.isLoading = true;\n    this._updateItemsChange$ = toObserver(this.items)\n      .subscribe(this.afterQueryItems, this.onError);\n  }\n\n  @bind\n  public afterQueryItems(items) {\n    this.isLoading = false;\n    this.queriedItems = this.queriedItems.concat(items);\n  }\n\n  @bind\n  public onError(err) {\n    console.error(err);\n  }\n\n  @bind\n  public hover(event: MouseEvent, item: any, index: number) {\n    if (!this.isDraging) return;\n    if (event.which === 0) return this.stopDrag(event);\n    if (this.hoveredIndex === index) {\n      this.direction = this.direction == Direction.Down ? Direction.Up : Direction.Down;\n    } else if (this.hoveredIndex < index) {\n      this.direction = Direction.Down;\n    } else {\n      this.direction = Direction.Up;\n    }\n    this.hoveredIndex = index;\n\n    event.stopPropagation();\n    event.preventDefault();\n    return false;\n  }\n\n  @bind\n  public startDarg(event: MouseEvent, item: any, index: number) {\n    this.isDraging = true;\n    this.dragedIndex = index;\n    this.dragedItem = item;\n    this.hoveredIndex = index;\n    this.direction = Direction.Up;\n    if (this.hoveredIndex === this.queriedItems.length) {\n      this.hoveredIndex--;\n      this.direction = Direction.Down;\n    }\n    event.stopPropagation();\n    event.preventDefault();\n    return false;\n  }\n\n  \n  @bind\n  public stopDrag(event: MouseEvent) {\n    if (!this.isDraging) return;\n    if (this.direction === Direction.Down) this.hoveredIndex++;\n    this.queriedItems.splice(this.hoveredIndex, 0, this.dragedItem);\n    if (this.dragedIndex > this.hoveredIndex) this.dragedIndex++;\n    this.queriedItems.splice(this.dragedIndex, 1);\n    this.isDraging = false;\n    this.hoveredIndex = null;\n    this.dragedIndex = null;\n    this.dragedItem = null;\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'ay-list',\n  template: `\n    <ng-template #defaultTitleTemplate=\"\" let-title=\"title\"><h2>{{ title }}</h2></ng-template><ng-template #defaultEmptyTemplate=\"\" let-empty=\"empty\">{{ empty }}</ng-template><ng-template #defaultItemTemplate=\"\" let-icon=\"icon\" let-index=\"index\" let-item=\"item\" let-list=\"list\"><div class=\"Item flex-1\">{{ item }}</div><div class=\"fa\" [ngClass]=\"icon\" (mousedown)=\"list.startDarg($event, item, index)\"></div></ng-template><ng-template [ngIf]=\"queriedItems.length\" [ngIfElse]=\"elseElement\" [ngIfThen]=\"thenElement\"></ng-template><ng-template #thenElement=\"\"><ng-template [ngTemplateOutlet]=\"titleTemplate\" [ngOutletContext]=\"{ title: title }\"></ng-template><ng-template [ngForOf]=\"queriedItems\" let-index=\"index\" let-item=\"\" ngFor=\"\"><ng-template [ngIf]=\"hoveredIndex == index &amp;&amp; direction == 1\"><div class=\"item shadow flex-row\"><ng-template [ngTemplateOutlet]=\"itemTemplate\" [ngOutletContext]=\"{ item: dragedItem, index: hoveredIndex, list: that, icon: icon }\"></ng-template></div></ng-template><div class=\"item flex-row\" *ngIf=\"dragedItem != item\" (mouseenter)=\"hover($event, item, index)\"><ng-template [ngTemplateOutlet]=\"itemTemplate\" [ngOutletContext]=\"{ item: item, index: index, list: that, icon: icon }\"></ng-template></div><ng-template [ngIf]=\"hoveredIndex == index &amp;&amp; direction == 0\"><div class=\"item flex-row shadow\"><ng-template [ngTemplateOutlet]=\"itemTemplate\" [ngOutletContext]=\"{ item: dragedItem, index: hoveredIndex, list: that, icon: icon }\"></ng-template></div></ng-template></ng-template></ng-template><ng-template #elseElement=\"\"><ng-template [ngTemplateOutlet]=\"titleTemplate\" [ngOutletContext]=\"{ title: title }\"></ng-template><ng-template [ngTemplateOutlet]=\"emptyTemplate\" [ngOutletContext]=\"{ empty: empty }\"></ng-template></ng-template>\n  `,\n  styles: [`\n    ay-list .item {\n      user-select: none; }\n\n    ay-list .Item {\n      padding: .5em 1em; }\n\n    ay-list .shadow {\n      background-color: #DDD; }\n\n    ay-list .fa-bars {\n      color: #CCC;\n      cursor: pointer; }\n  `],\n  encapsulation: ViewEncapsulation.None\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ApplicationRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'title': [{ type: Input },],\n'icon': [{ type: Input },],\n'items': [{ type: Input },],\n'empty': [{ type: Input },],\n'defaultItemTemplate': [{ type: ViewChild, args: [\"defaultItemTemplate\", ] },],\n'itemTemplate': [{ type: ContentChild, args: [\"itemTemplate\", ] },],\n'defaultTitleTemplate': [{ type: ViewChild, args: [\"defaultTitleTemplate\", ] },],\n'titleTemplate': [{ type: ContentChild, args: [\"titleTemplate\", ] },],\n'defaultEmptyTemplate': [{ type: ViewChild, args: [\"defaultEmptyTemplate\", ] },],\n'emptyTemplate': [{ type: ContentChild, args: [\"emptyTemplate\", ] },],\n'stopDrag': [{ type: HostListener, args: [\"mouseup\", ['$event'], ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}