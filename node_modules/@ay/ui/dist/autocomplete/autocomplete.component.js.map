{"version":3,"sources":["../../tmp/autocomplete/autocomplete.component.ts"],"names":[],"mappings":"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","file":"autocomplete.component.js","sourceRoot":"","sourcesContent":["import { Component, AfterContentInit, OnDestroy, AfterViewInit, Output, ViewEncapsulation, EventEmitter, Input, HostListener, ViewChild, ElementRef, ContentChild, TemplateRef } from '@angular/core';\nimport { toObservable, bind, toObserver, defaults } from \"@ay/util/dist\";\nimport { Observable } from \"rxjs/Rx\";\nimport { DropdownComponent } from \"../dropdown/dropdown.component\";\nimport { Subject } from \"rxjs/Subject\";\nimport { Subscription } from \"rxjs/Subscription\";\n\nexport type SelectItemCondition = (target: AutocompleteComponent, item: any) => void;\n\nexport class AutocompleteComponent implements AfterContentInit {\n  private _dropdown$: Subscription;\n  private _keydown$: Subscription;\n  public isIMEComposing: boolean;\n  public isOpen: boolean;\n  public keydown = new Subject();\n  public queriedItems: Observable<any[]>;\n\n  \n  public inputBackground: string;\n\n  \n  public debounce: number = 300;\n\n  \n  public itemMaxCount: number = -1;\n\n  /** items */\n  private _items: toObservable<any>;\n\n  \n  public itemsChange: EventEmitter<toObservable<any>> = new EventEmitter<toObservable<any>>();\n\n  \n  public get items(): toObservable<any> {\n    return this._items;\n  }\n\n  public set items(items: toObservable<any>) {\n    if (this._items === items) return;\n    this._items = items;\n    this.itemsChange.emit(this._items);\n  }\n\n  /** data */\n  private _data: string;\n\n  \n  public dataChange: EventEmitter<string> = new EventEmitter<string>();\n\n  \n  public get data(): string {\n    return this._data;\n  }\n\n  public set data(data: string) {\n    if (this._data === data) return;\n    this._data = data;\n    this.dataChange.emit(this._data);\n  }\n\n  /** dropdown */\n  private _dropdown: string;\n\n  \n  public dropdownChange: EventEmitter<string> = new EventEmitter<string>();\n\n  \n  public get dropdown(): string {\n    return this._dropdown;\n  }\n\n  public set dropdown(dropdown: string) {\n    if (this._dropdown === dropdown) return;\n    this._dropdown = dropdown;\n    this.dropdownChange.emit(this._dropdown);\n  }\n\n  /** select */\n\n  private _selectItem: SelectItemCondition =\n  (target, item) => target.data = item;\n\n  public selectChange: EventEmitter<SelectItemCondition> = new EventEmitter<SelectItemCondition>();\n\n  \n  public get selectItem(): SelectItemCondition {\n    return this._selectItem;\n  }\n\n  public set selectItem(select: SelectItemCondition) {\n    if (this._selectItem === select) return;\n    this._selectItem = select;\n    this.selectChange.emit(this._selectItem);\n  }\n\n  // element\n  \n  public dropdownElement: DropdownComponent = null;\n\n  \n  public inputElement: ElementRef = null;\n\n  // template\n  \n  public defaultItemUsedTemplate: ElementRef = null;\n\n  \n  public itemUsedTemplate: TemplateRef<any> = null;\n\n  // 事件\n  public constructor() { }\n\n  public ngAfterContentInit() {\n    this.itemUsedTemplate = defaults(this.itemUsedTemplate, this.defaultItemUsedTemplate);\n    this._keydown$ = this.keydown.debounceTime(this.debounce).subscribe(this.afterDataChange, this.onError)\n    this._dropdown$ = this.dropdownChange.subscribe(this.afterDropdownChange, this.onError);\n\n  }\n\n  public ngOnDestroy() {\n    this._keydown$.unsubscribe();\n    this._dropdown$.unsubscribe();\n  }\n\n  @bind\n  public afterDataChange() {\n    this.queriedItems = toObserver(this.items, this.data);\n    this.isOpen = true;\n  }\n\n  @bind\n  public afterDropdownChange() {\n    this.selectItem(this, this.dropdown);\n    // setTimeout(() => { }, 100);\n  }\n\n  @bind\n  public onFocus() {\n    this.isOpen = true;\n  }\n\n  @bind\n  public onBlur() {\n    this.isOpen = false;\n  }\n\n  @bind\n  public onError(err) {\n    console.error(err);\n  }\n\n  @bind\n  \n  public onCompositionStart() {\n    this.isIMEComposing = true;\n  }\n\n  @bind\n  \n  public onCompositionEnd() {\n    this.isIMEComposing = false;\n  }\n\n  @bind\n  \n  public onKeydown(e: KeyboardEvent) {\n    if (!this.isIMEComposing) {\n      if (!this.dropdownElement.onKeydown(e)) {\n        this.keydown.next(e);\n      }\n    }\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'ay-autocomplete',\n  template: `\n    <ng-template #defaultItemTemplate=\"\" let-disable=\"disable\" let-index=\"index\" let-item=\"item\" let-dropdown=\"dropdown\"><div class=\"item\" [innerHtml]=\"item | highlight : data\" [ngClass]=\"{ hover: dropdown.hoverIndex == index, disable: disable}\"></div></ng-template><ay-input #inputElement=\"\" [(data)]=\"data\" type=\"text\" [targetBlur]=\"onBlur\" (focus)=\"onFocus()\" [inputBackground]=\"inputBackground\"><ng-template #autocompleteTemplate=\"\"><div class=\"DingGongZi\"></div><ay-dropdown #dropdownElement=\"\" [(data)]=\"dropdown\" [(isOpen)]=\"isOpen\" [(items)]=\"queriedItems\" [maxCount]=\"itemMaxCount\"><ng-template #displayTemplate=\"\"></ng-template><ng-template #itemTemplate=\"\" let-disable=\"disable\" let-index=\"index\" let-item=\"item\" let-dropdown=\"dropdown\">{{ dropdown }}<ng-template [ngTemplateOutlet]=\"itemUsedTemplate\" [ngOutletContext]=\"{ disable: disable, index: index, item: item, dropdown: dropdown }\"></ng-template></ng-template></ay-dropdown></ng-template></ay-input>\n  `,\n  styles: [`\n    ay-autocomplete input {\n      vertical-align: top;\n      display: inline-block;\n      margin: 10px;\n      width: 100%;\n      box-sizing: border-box;\n      margin: 0; }\n      ay-autocomplete input input {\n        padding: .25em .5em;\n        font-size: 1em;\n        line-height: 1.5em;\n        border: 1px solid transparent;\n        outline: none !important;\n        transition: all .1s linear; }\n        ay-autocomplete input input:focus {\n          box-shadow: 0 1px 7px rgba(0, 0, 0, 0.05), 0 7px 17px rgba(0, 0, 0, 0.1); }\n\n    ay-autocomplete ay-dropdown {\n      width: 100%;\n      margin: 0;\n      position: absolute; }\n  `],\n  encapsulation: ViewEncapsulation.None\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'inputBackground': [{ type: Input },],\n'debounce': [{ type: Input },],\n'itemMaxCount': [{ type: Input, args: [\"maxCount\", ] },],\n'itemsChange': [{ type: Output },],\n'items': [{ type: Input },],\n'dataChange': [{ type: Output },],\n'data': [{ type: Input },],\n'dropdownChange': [{ type: Output },],\n'dropdown': [{ type: Input },],\n'selectItem': [{ type: Input },],\n'dropdownElement': [{ type: ViewChild, args: [\"dropdownElement\", ] },],\n'inputElement': [{ type: ViewChild, args: [\"inputElement\", ] },],\n'defaultItemUsedTemplate': [{ type: ViewChild, args: [\"defaultItemTemplate\", ] },],\n'itemUsedTemplate': [{ type: ContentChild, args: [\"itemTemplate\", ] },],\n'onCompositionStart': [{ type: HostListener, args: [\"compositionstart\", ] },],\n'onCompositionEnd': [{ type: HostListener, args: [\"compositionend\", ] },],\n'onKeydown': [{ type: HostListener, args: [\"keydown\", [\"$event\"], ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}